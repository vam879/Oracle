/*
    날짜 : 2025/07/15
    이름 : 고정현
    내용 : 3장 SQL 고급
*/

--실습 301 테이블 생성 및 데이터 입력
CREATE TABLE EMP(
    EMPNO CHAR(4) PRIMARY KEY,
    NAME VARCHAR2(20),
    GENDER CHAR(2),
    JOB VARCHAR2(10),
    DEPNO CHAR(2),
    REGDATE VARCHAR2(20)
);
INSERT INTO EMP VALUES (1001, '김유신', 'M', '사원', 10, SYSDATE);
INSERT INTO EMP VALUES (1002, '김춘추', 'M', '대리', 20, SYSDATE);
INSERT INTO EMP VALUES (1003, '장보고', 'M', '과장', 10, SYSDATE);
INSERT INTO EMP VALUES (1004, '강감찬', 'M', '부장', 30, SYSDATE);
INSERT INTO EMP VALUES (1005, '신사임당', 'F', '대리', 20, SYSDATE);
INSERT INTO EMP VALUES (1006, '이황', 'M', '사원', 40, SYSDATE);
INSERT INTO EMP VALUES (1007, '이이', 'M', '과장', 20, SYSDATE);
INSERT INTO EMP VALUES (1008, '이순신', 'M', '사원', NULL, SYSDATE);
INSERT INTO EMP VALUES (1009, '허난설헌', 'F', '사원', NULL, SYSDATE);
INSERT INTO EMP VALUES (1010, '정약용', 'M', '대리', 50, SYSDATE);
---------

CREATE TABLE DEPT(
    DEPTNO  NUMBER(2),
    DNAME   VARCHAR2(20),
    DTEL    CHAR(13)
);

INSERT INTO DEPT (DEPTNO, DNAME, DTEL) VALUES (10, '영업1부', '051-511-1000');
INSERT INTO DEPT (DEPTNO, DNAME, DTEL) VALUES (20, '영업2부', '051-511-2000');
INSERT INTO DEPT (DEPTNO, DNAME, DTEL) VALUES (30, '영업3부', '051-511-3000');
INSERT INTO DEPT (DEPTNO, DNAME, DTEL) VALUES (40, '영업4부', '051-511-4000');
INSERT INTO DEPT (DEPTNO, DNAME, DTEL) VALUES (50, '영업지원부', '051-511-5000');
-----------------

CREATE TABLE SALE(
    NO      VARCHAR2(20),
    EMPNO   CHAR(4),
    YEAR    CHAR(4),
    MONTH   NUMBER(2),
    PRICE   VARCHAR2(20)
);
INSERT INTO SALE (EMPNO, YEAR, MONTH,

PRICE) VALUES (1001, 2023, 1, 98100);

INSERT INTO SALE (EMPNO, YEAR, MONTH,

PRICE) VALUES (1002, 2023, 1, 136000);

INSERT INTO SALE (EMPNO, YEAR, MONTH,

PRICE) VALUES (1003, 2023, 1, 80000);

INSERT INTO SALE (EMPNO, YEAR, MONTH,

PRICE) VALUES (1004, 2023, 1, 78000);

INSERT INTO SALE (EMPNO, YEAR, MONTH,

PRICE) VALUES (1005, 2023, 1, NULL);

INSERT INTO SALE (EMPNO, YEAR, MONTH,

PRICE) VALUES (1001, 2023, 2, 23500);

INSERT INTO SALE (EMPNO, YEAR, MONTH,

PRICE) VALUES (1002, 2023, 2, 126000);

INSERT INTO SALE (EMPNO, YEAR, MONTH,

PRICE) VALUES (1003, 2023, 2, 18500);

INSERT INTO SALE (EMPNO, YEAR, MONTH,

PRICE) VALUES (1005, 2023, 2, 19000);

INSERT INTO SALE (EMPNO, YEAR, MONTH,

PRICE) VALUES (1010, 2023, 2, 53000);

INSERT INTO SALE (EMPNO, YEAR, MONTH,

PRICE) VALUES (1001, 2024, 1, 24000);

INSERT INTO SALE (EMPNO, YEAR, MONTH,

PRICE) VALUES (1002, 2024, 1, 109000);

INSERT INTO SALE (EMPNO, YEAR, MONTH,

PRICE) VALUES (1003, 2024, 1, 80000);

INSERT INTO SALE (EMPNO, YEAR, MONTH,

PRICE) VALUES (1004, 2024, 1, NULL);

INSERT INTO SALE (EMPNO, YEAR, MONTH,

PRICE) VALUES (1007, 2024, 1, 24000);

INSERT INTO SALE (EMPNO, YEAR, MONTH,

PRICE) VALUES (1002, 2024, 2, 160000);

INSERT INTO SALE (EMPNO, YEAR, MONTH,

PRICE) VALUES (1003, 2024, 2, 101000);

INSERT INTO SALE (EMPNO, YEAR, MONTH,

PRICE) VALUES (1004, 2024, 2, 43000);

INSERT INTO SALE (EMPNO, YEAR, MONTH,

PRICE) VALUES (1005, 2024, 2, 24000);

INSERT INTO SALE (EMPNO, YEAR, MONTH,

PRICE) VALUES (1006, 2024, 2, 109000);

--실습 2-1
SELECT * FROM EMP WHERE NAME != '김춘추';
SELECT * FROM EMP WHERE NAME <> '김춘추';

SELECT * FROM EMP WHERE JOB ='사원' OR JOB = '대리';
SELECT * FROM EMP WHERE JOB IN ('사원', '대리');

SELECT * FROM emp WHERE NAME LIKE '김%';
SELECT * FROM emp WHERE NAME LIKE '%신';
SELECT * FROM emp WHERE NAME LIKE '이_';
SELECT * FROM emp WHERE NAME LIKE '이__';

--실습하기 2-2
SELECT * FROM SALE ORDER BY PRICE;
SELECT * FROM SALE ORDER BY PRICE ASC;
SELECT * FROM SALE ORDER BY PRICE DESC;
SELECT * FROM EMP ORDER BY NAME DESC;
SELECT * FROM EMP ORDER BY REGDATE ASC;

SELECT * FROM SALE WHERE PRICE > 50000 ORDER BY PRICE DESC;
SELECT * FROM SALE
    WHERE PRICE > 50000
    ORDER BY YEAR DESC, MONTH, PRICE DESC;
    
SELECT * FROM SALE FETCH FIRST 3 ROW ONLY;
SELECT * FROM SALE OFFSET 0 ROWS FETCH NEXT 3 ROWS ONLY;
SELECT * FROM SALE OFFSET 1 ROWS FETCH NEXT 2 ROWS ONLY;
SELECT * FROM SALE OFFSET 5 ROWS FETCH NEXT 3 ROWS ONLY;
SELECT * FROM SALE ORDER BY PRICE DESC OFFSET 3 ROWS FETCH NEXT 5 ROWS ONLY;
SELECT * FROM SALE
    WHERE SALE < 50000
    ORDER BY PRICE DESC
    FETCH FIRST 3 ROW ONLY;
    
SELECT * FROM SALE
    WHERE PRICE > 50000
    ORDER BY YEAR DESC, MONTH, PRICE DESC
    FETCH FIRST 5 ROWS ONLY;
    
    ----실습하기 2-3
SELECT DISTINCT DEPNO FROM EMP;
SELECT DISTINCT JOB, DEPNO FROM EMP;

SELECT EMPNO AS 사번, NAME AS 이름, GENDER AS 성별 FROM EMP;

SELECT EMPNO E, NAME N, GENDER G FROM EMP;

--------------------3-2
SELECT 'HELLO ORACLE!', LENGTH('HELLO ORACLE!') FROM DUAL;
SELECT
    'HELLO ORACLE!'
    SUBSTR('HELLO ORACLE!', 1, 3),
    SUBSTR('HELLO ORACLE!', 3, 2),
    SUBSTR('HELLO ORACLE!' 5)
    FORM DUAL;

SELECT
    INSTR('HELLO ORACLE!', 'L') as INSTR_1,
    INSTR('HELLO ORACLE!', 'L', -1) as INSTR_2
from
    dual;

SELECT '010-1234-5678', REPLACE('010-1234-5678', '-', '') FROM DUAL
--------------
SELECT LPAD('Oracle', 10, '#') AS LPAD, RPAD('Oracle', 10, '*') AS RPAD FROM DUAL;

---------------------

SELECT CONCAT(EMPNO, NAME) FROM EMP WHERE NAME = '이순신';
SELECT EMPNO || NAME FROM EMP WHERE NAME = '정약용';

//TRIM : 문자 공백 제거
SELECT
    '[ _Oracle_ ]' AS BEFORE,
    '[' || TRIM(' _Oracle_ ') || ']' AS TRIM
FROM DUAL;

//SYSDATE
SELECT
    SYSDATE,
    SYSDATE - 1,
    SYSDATE + 1
FROM
    DUAL;
    
    //ADD_MONTHS
SELECT
    ADD_MONTHS(SYSDATE, 1),
    ADD_MONTHS(SYSDATE, -1)
FROM DUAL;

// MONTHS_BETWEEN(D1, D2) : 두 날짜간 개월 수 계산
SELECT
    MONTHS_BETWEEN(DATE '2025-07-13', DATE '2024-07-13') AS 개월차
FROM DUAL;

//NEXT_DAY
SELECT
    NEXT_DAY(SYSDATE, '월요일')AS 다음_월요일
FROM DUAL;

-----------실습하기 3-4

SELECT
    TO_CHAR(SYSDATE, 'YYYY') AS YYYY,
    TO_CHAR(SYSDATE, 'MM') AS YYYY,
    TO_CHAR(SYSDATE, 'DD') AS YYYY,
    TO_CHAR(SYSDATE, 'HH24') AS YYYY,
    TO_CHAR(SYSDATE, 'MI') AS YYYY,
    TO_CHAR(SYSDATE, 'SS') AS YYYY,
    TO_CHAR(SYSDATE, 'YYYY/MM/DD HH24:MI:SS') AS 날짜시간
FROM
    DUAL;
    
INSERT INTO EMP 
VALUES (1011, '안중근', 'M', '부장', 30, TO_CHAR(SYSDATE, 'YYYY/MM/DD HH24:MI:SS'));

SELECT
    TO_DATE('20250714', 'YYYY/MM/DD') as 날짜1,
    TO_DATE('250714', 'YYYY/MM/DD') as 날짜2
    TO_DATE(SYSDATE, 'YYYY/MM/DD HH24:MI:SS') as 날짜3
FROM
    DUAL;
    
INSERT INTO EMP VALUES (1012, '유관순', 'F', '차장', 20, SYSDATE);

INSERT INTO EMP VALUES (1013, '윤봉길', 'M', '과장', 30,
                    TO_DATE(SYSDATE, 'YYYY-MM-DD HH24:MI:SS'));
                    
// NVL, NVL2 : NULL 체크함수
SELECT
    NO,
    EMPNO,
    YEAR,
    MONTH,
    NVL(PRICE, 0)
FROM SALE;
---------------
SELECT
    EMPNO,
    NAME,
    GENDER,
    JOB,
    NVL2(DEPTNO, '정규직', '비정규직')
FROM EMP;

-------실습 3-4 SQL 기타 함수
SELECT
    TO_CHAR(SYSDATE, 'YYYY') AS YYYY,
    TO_CHAR(SYSDATE, 'MM') AS MM,
    TO_CHAR(SYSDATE, 'DD') AS DD,
    TO_CHAR(SYSDATE, 'HH24') AS HH24,
    TO_CHAR(SYSDATE, 'MI') AS MI,
    TO_CHAR(SYSDATE, 'SS') AS SS,
    TO_CHAR(SYSDATE, 'YYYY/MM/DD HH24:MI:SS') AS 날짜시간
FROM DUAL;

-----------실습 4-1
SELECT EMPNO FROM SALE GROUP BY EMPNO;
SELECT YEAR FROM SALE GROUP BY YEAR;

SELECT EMPNO, YEAR FROM SALE GROUP BY EMPNO, YEAR;

SELECT EMPNO, COUNT(*) AS 판매건수 FROM SALE GROUP BY EMPNO;

SELECT EMPNO, SUM(PRICE) AS 합계 FROM SALE GROUP BY EMPNO;

SELECT EMPNO, YEAR, SUM(price) AS 합계
    FROM sale
    GROUP BY empno, year;

SELECT 
    EMPNO, YEAR, SUM(price) AS 합계
FROM SALE
WHERE PRICE >= 50000
GROUP BY EMPNO, YEAR
HAVING SUM(price)>= 200000
ORDER BY 합계 DESC
-------------------------

SELECT 
    EMPNO,
    YEAR,
    SUM(price)
FROM SALE 
WHERE PRICE >= 100000 
GROUP BY EMPNO, YEAR 
HAVING SUM(price) >= 200000 
ORDER BY SUM(price) DESC;
-------------- 5-1
SELECT EMPNO, MONTH, PRICE FROM SALE WHERE YEAR = 2023
UNION
SELECT EMPNO, MONTH, PRICE FROM SALE WHERE YEAR = 2024;

SELECT EMPNO, MONTH, PRICE FROM SALE WHERE YEAR = 2023
UNION ALL
SELECT EMPNO, MONTH, PRICE FROM SALE WHERE YEAR = 2024;

SELECT EMPNO, YEAR, SUM(PRICE) AS 합계
FROM SALE
WHERE YEAR = 2023
GROUP BY EMPNO, YEAR
UNION
SELECT EMPNO, YEAR, SUM(PRICE) AS 합계
FROM SALE
WHERE YEAR = 2024
GROUP BY EMPNO, YEAR 
ORDER BY YEAR ASC, 합계 DESC;

------ 실습 6-1
SELECT
    *
FROM EMP E
JOIN DEPT D
ON E.DEPTNO = D.DEPTNO;

SELECT
    *
FROM EMP E
JOIN DEPT D
USING (DEPTNO);

SELECT
    *
FROM EMP E, DEPT D
WHERE E.DEPTNO = D.DEPTNO;

SELECT * FROM EMP E, DEPT D WHERE E.DEPNO = D.DEPTNO;

SELECT
    S.NO,
    S.EMPNO,
    E.NAME,
    E.JOB,
    E,REGDATE,
    D.DNAME
FROM SALE S
JOIN EMP E ON S.EMPNO = E.EMPNO
JOIN DEPT D ON E.DEPNO = D.DEPTNO
WHERE PRICE > 100000 AND YEAR = 2024
ORDER BY S.PRICE DESC;

---실습 6-2
DELETE FROM EMP WHERE EMPNO = 1006;

SELECT 
    *
FROM SALE S
,JOIN EMP E ON S.EMPNO = E.EMPNO;


